<div class="col-sm-12 zonalStat">
    <div class="no-data row view-container app-radial-tree"
    *ngIf="salesDataSet['messageBody']?.investors.length == 0 && afterSalesDataSet['messageBody']?.investors.length == 0">
    {{nodataerrmsg}}&nbsp;<div class="cursor-pointer border-none outline-none" routerLink="/admin/engagementList">Go
        <span class="fa fa-arrow-right"></span>
    </div>
</div>
<div class="no-data row view-container app-radial-tree" *ngIf="loadingDealer">
    <h2>Loading...</h2>
</div>
<!-- <div class="no-data row view-container app-radial-tree" *ngIf="!selectedDealer && !loadingDealer">
    <h2>No data</h2>
</div> -->
<div class="row view-container app-radial-tree" >
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-12 top-dash-nav">

                <div class="switch-cont ">
                    <h4 class="toggle-before">Sales</h4>
                    <div>
                        <mat-slide-toggle [(ngModel)]="switch" (change)="switchSales()"></mat-slide-toggle>
                    </div>
                    <h4 class="toggle-after">After sales</h4>
                </div>
                <div class="dealer-details ">
                    <div class="filter-spacing">
                        <label for="" class="font-weight-400">Dealer</label>
                    </div>
                    <div class="filter-cont border box-size">
                        <select class="custom-select" (change)="selectDealer(selectedDealer)" *ngIf="selectedDealer"
                            [(ngModel)]="selectedDealer" [disabled]="!allDealers || allDealers.length==0">
                            <option *ngFor="let dealer of allDealers" [ngValue]="dealer">
                                {{dealer?.dealer_name}}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="dealer-details">
                    <div class="filter-spacing">
                        <label class="font-weight-400">Investor</label>
                    </div>
                    <div class="border box-size font-size-17">{{selectedDealer?.investor_name}}</div>

                </div>
                <div class="dealer-details">
                    <div class="filter-spacing">
                        <label class="font-weight-400">Category</label>
                    </div>
                    <div class="category-val border">{{selectedDealer?.dealer_category | uppercase}}</div>

                </div>

            </div>
        </div>
        <!-- <button (click)="downloadExcel()" class="btn btn-default btn-sec close_button">Extract</button> -->
        <div class="row score " *ngIf="selectedDealer && !loadingDealer">
            <div class="col-md-8 hybrid-chart-wrapper dealer-title">
                <div class="hybrid-container " [ngStyle]="{'width':currRole == '3' ? '83%':'100%'}">
                    <div class="row chkboxgroup">
                        <div class="custom-checkbox-d">

                            <label class="script">
                                Dealer score
                                <input name="Dealer" [(ngModel)]="isChecked" (change)="checkValue('d')"
                                    type="checkbox" checked>
                                <span class="geekmark"></span>
                            </label>
                        </div>
                        <div class="custom-checkbox-c">
                            <label class="script">
                                Category average
                                <input name="category" [(ngModel)]="isCheckedcatavg" (change)="checkValue('c')"
                                    type="checkbox" checked>
                                <span class="geekmark"></span>
                            </label>
                        </div>
                        <div class="custom-checkbox-n">


                            <label class="script">
                                National average
                                <input name="national" [(ngModel)]="isCheckedntgavg" (change)="checkValue('n')"
                                    type="checkbox" checked>
                                <span class="geekmark"></span>
                            </label>

                        </div>

                    </div>
                    <div class="chart-container">

                        <!-- RADAR BCKGRND -->
                        <div class="radarbackground"></div>
                        <!-- PIE CHART -->
                        <div id="piechart">
                            <div [attr.id]="piedynamicId" class=""></div>
                        </div>
                        <!-- RADAR CHART -->
                        <div id="radarChart"></div>
                    </div>


                </div>
            </div>
            <div class="col-md-4 dealerdescription">
                

                <div class="row m-0">
                    <div class="info-container">
                        <div class="info-1">
                            <div class="info-title">Sales</div>
                            <div class="info-icon">
                                <img class="" height="100" src="assets/images/PwC_Pictograms_Car_White_RGB.svg"
                                    width="100">
                            </div>

                        </div>
                        <div class="info-2">{{selectedDealer?.dealerSalesScore?.score}}% &emsp;</div>

                    </div>
                </div>
                <div class="row m-0">
                    <div class="info-container">
                        <div class="info-1">
                            <div class="info-title">After sales</div>
                            <div class="info-icon">
                                <img class="" height="100" src="assets/images/PwC_Pictograms_Cogs_White_RGB.png"
                                    width="100">
                            </div>

                        </div>
                        <div class="info-2">{{selectedDealer?.dealerAfterSalesScore?.score}}% &emsp;</div>
                    </div>
                </div>


                <div class="details-card" *ngFor="let data of radarDataSet ; let i =index;">
                    <div class="details-header">
                        {{data.key}}
                        <span class="flip" *ngIf="!showLevel[i]" (click)="selectIndex(i)"><i
                                class="fa fa-expand"></i></span>
                        <span class="flip" *ngIf="showLevel[i]" (click)="selectIndex(i)"><i
                                class="fa fa-compress"></i></span>
                    </div>
                    <div class="detail-expansion" *ngIf="showLevel[i]">
                        <div class="details-body" *ngFor="let el of data?.values">
                            <div class="details" *ngIf="el?.axis.toLowerCase() != 'aap' ">
                                <div class="details-title">
                                    {{el?.axis}}
                                </div>
                                <div class="details-score">
                                    {{(el?.value)}} %
                                </div>
                            </div>
                            <div class="progress" *ngIf="el?.axis.toLowerCase() != 'aap' ">
                                <div class="progress-bar w-75" role="progressbar"
                                    [style.width]="(el?.value*100) + '%'" aria-valuenow="75" aria-valuemin="0"
                                    aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row kpi-details" *ngIf="selectedDealer && !loadingDealer">
            <div class="col-md-12 p-0">
                <div class="col-md-12 kpi-container">
                    <div class="col-md-2">
                        <h4 class="text-center">Audit areas</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">Total KPIs</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">KPIs "Yes"</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">KPIs "No"</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">KPIs "N/A"</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">Score</h4>
                    </div>
                </div>
                <div *ngFor="let item of selectedDealer?.dealerAreaDetails" class="col-md-12 kpi-container-num">
                    <div class="col-md-2 highlight">
                        <p>{{item?.category_name}}</p>
                    </div>
                    <div class="col-md-2 num">
                        <h4>{{item?.totalKpis}}</h4>
                    </div>
                    <div class="col-md-2 num">
                        <h4>{{item?.kpisYes}}</h4>
                    </div>
                    <div class="col-md-2 num">
                        <h4>{{item?.kpisNo}}</h4>
                    </div>
                    <div class="col-md-2 num">
                        <h4>{{item?.kpisNA}}</h4>
                    </div>
                    <div class="col-md-2 num">
                        <h4>{{item?.score}}%</h4>
                    </div>
                </div>
                <div class="col-md-12 kpi-container-bottom">
                    <div class="col-md-2 bottom">
                        <h4>Total</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.totalKpis}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.totalKpisYes}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.totalKpisNo}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.totalKpisNA}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.totalScore}}%</h4>
                    </div>
                </div>
            </div>
        </div>

<!-- THIS SECTION WILL BE USED ONLY FOR THE OLDER VERSION OF AUDITS -->
        <div class="row kpi-details" *ngIf="false">
            <div class="col-md-12">
                <div class="col-md-12 kpi-container">
                    <div class="col-md-2">
                        <h4 class="text-center">Audit Areas</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">Total Buckets</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">Buckets "Yes"</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">Buckets "No"</h4>
                    </div>
                    <div class="col-md-2">
                        <h4 class="text-center">Score</h4>
                    </div>
                </div>
                <!-- <div class="col-md-12 kpi-container-num">
                    <*ngFor="let item of selectedDealer?.stores[0]?.questionnaires[0]?.category_beans"
                    <div class="col-md-2 highlight">
                        <p>{{item?.category_name}}</p>
                    </div>
                    <div class="col-md-2 num">
                        <h4>{{item?.categoryBktCount}}</h4>
                    </div>
                    <div *ngIf="item?.appFlag;else elseYesBktContBlock" class="col-md-2 num">
                        <h4>N/A</h4>
                    </div>
                    <ng-template #elseYesBktContBlock>
                        <div class="col-md-2 num">
                            <h4>{{item?.categoryYesBktCount}}</h4>
                        </div>
                    </ng-template>
                    <div *ngIf="item?.appFlag;else elseNoBktContBlock" class="col-md-2 num">
                        <h4>N/A</h4>
                    </div>
                    <ng-template #elseNoBktContBlock>
                        <div class="col-md-2 num">
                            <h4>{{item?.categoryNoBktCount}}</h4>
                        </div>
                    </ng-template>
                    <div *ngIf="item?.appFlag;else elsecatScoreBlock" class="col-md-2 num">
                        <h4>N/A</h4>
                    </div>
                    <ng-template #elsecatScoreBlock>
                        <div class="col-md-2 num">
                            <h4>{{item?.categoryScore}}%</h4>
                        </div>
                    </ng-template>
                </div> -->
                <div class="col-md-12 kpi-container-bottom">
                    <div class="col-md-2 bottom">
                        <h4>Total</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.dealerBktCount}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.dealerYesBktCount}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.dealerNoBktCount}}</h4>
                    </div>
                    <div class="col-md-2 bottom">
                        <h4>{{selectedDealer?.dealerScore}}%</h4>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" #kpidetailssection id="kpi-details-section" *ngIf="selectedDealer && !loadingDealer">
            <div class="kpi-details-card">
                <div class="kpi-toggle" [ngClass]="{'kpi-toggle-style':!flag}"
                    (click)="toggleKpiSection(kpidetailssection)">
                    <span>Detailed view of KPI's &nbsp; <i class="fa fa-long-arrow-right"></i></span>

                    <span class="flip" *ngIf="!flag"><i class="fa fa-expand"></i></span>
                    <span class="flip" *ngIf="flag"><i class="fa fa-compress"></i></span>
                </div>
                <div *ngIf="flag">
                    <div class=" row">
                        <div class="col-md-12">
                            <div class="kpi-details-filters">
                                <div class="col-md-4" class="kpi-details-div">
                                    <span for="">Areas&nbsp;:&nbsp;</span>
                                    <ng-multiselect-dropdown class="multi-select"
                                        [placeholder]="'Select area                 '" [data]="dropdownAreaList"
                                        [(ngModel)]="selectedAreas" [settings]="dropdownSettings"
                                        (onSelect)="onAreaSelect()" (onDeSelect)="onAreaSelect()"
                                        (onDeSelectAll)="onAreaSelect()" (onSelectAll)="onAreaSelect()"
                                        [ngModelOptions]="{standalone: true}">
                                    </ng-multiselect-dropdown>
                                </div>

                                <div class="col-md-4" class="kpi-details-div">
                                    <span for="">Buckets&nbsp;:&nbsp;</span>
                                    <ng-multiselect-dropdown class="multi-select"
                                        [placeholder]="'Select bucket                '" [data]="dropdownBktList"
                                        [(ngModel)]="selectedBkts" [settings]="dropdownSettings"
                                        (onSelect)="onBktSelect($event)" (onDeSelect)="onBktSelect($event)"
                                        (onSelectAll)="onBktSelect($event)" (onDeSelectAll)="onBktSelect($event)"
                                        [ngModelOptions]="{standalone: true}">
                                    </ng-multiselect-dropdown>
                                </div>
                                <div class="col-md-4" class="kpi-details-div">
                                    <span class="toggle-before">Show only non-compliant KPIs&nbsp;:&nbsp;</span>
                                    <mat-slide-toggle [(ngModel)]="showNonCompliantKpis" (change)="showNonComKpis()">
                                    </mat-slide-toggle>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <table class="table table-striped table-responsive table-hover">
                                <thead>
                                    <th>KPI no.</th>
                                    <th style="width:30%">KPI description</th>
                                    <th style="width:15%">Current state</th>
                                    <th style="width:15%">Root cause</th>
                                    <th style="width:15%">Action plan</th>
                                    <th style="width:15%">Responsibility</th>
                                    <th style="width:10%">Timeline</th>
                                    <th>Evidences</th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let kpi of allKpis">
                                        <td>
                                            <div>{{kpi.kpi_number}}</div>
                                        </td>
                                        <td class="desc">
                                            <div>{{kpi.q_description}}</div>
                                        </td>
                                        <td class="desc">
                                            <div>{{kpi.current_state}}</div>
                                        </td>
                                        <td class="desc">
                                            <div>{{kpi.root_cause}}</div>
                                        </td>
                                        <td class="desc">
                                            <div>{{kpi.auditor_recommendation}}</div>
                                        </td>
                                        <td class="desc">
                                            <div>{{kpi.responsibility}}</div>
                                        </td>
                                        <td>
                                            <div>{{kpi.timeline|date}}</div>
                                        </td>
                                        <td class="desc text-center">
                                            <!-- {{kpi?.evidences?.length==1}} && {{!kpi?.evidences[0].evidenceName}} -->
                                            <button class="btn btn-clear" [ngClass]="(!kpi?.evidences || kpi?.evidences?.length==0)?'disabled':null"
                                                (click)="openModal(kpi)" [disabled]="!kpi?.evidences || kpi?.evidences?.length==0">
                                                <span class="fa fa-download downld-icon" data-toggle="modal"
                                                    data-target="#evidenceModalTest">
                                                </span>
                                                <span class="badge custom-badge">{{kpi?.evidences?.length}}</span>
                                            </button>

                                        </td>
                                    </tr>
                                    <tr *ngIf="allKpis.length==0 && !loadingkpis">
                                        <td colspan="7" class="desc">No data</td>
                                    </tr>
                                    <tr *ngIf="loadingkpis">
                                        <td colspan="7" class="desc">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" *ngIf="!selectedDealer && !loadingDealer"><h4>No data</h4></div>
    </div>
</div>

<!-- Modal to display evidences -->
<div class="modal fade" id="evidenceModalTest" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Evidences</h4>
            </div>
            <div class="modal-body filter_model_body">
                <div *ngIf="modalEvidences.length>0">
                    <div *ngFor="let evidence of modalEvidences" class="evidence-container">
                        <div class="evidences" style="display: flex;
                        word-break: break-word;
                        white-space: normal;
                        align-items: center;
                        justify-content: space-between;
                        border: 1px solid #cccccc;
                        padding: 4px;
                        margin: 4px;">
                            <span *ngIf="!isImage(evidence) && evidence" class="fa fa-files-o" class="large"></span>
                            <img *ngIf="isImage(evidence)" style="margin: 5px;" [src]="evidence" alt="" width="200"
                                height="140">
                            <a class="evidence-name" target="_blank" [href]="evidence">{{evidence}}</a>
                        </div>
                        <span *ngIf="!evidence" class="text-danger">There is no evidence uploaded for this
                            KPI.</span>
                    </div>
                </div>
                <div *ngIf="modalEvidences.length==0">
                    <span class="fa fa-ban"></span>
                </div>

            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-default btn-main" data-dismiss="modal">Ok</button>
            </div>
        </div>
    </div>
</div>
  </div>
  <div class="col-sm-3">
    <!-- <app-progress-bars [categoriesData]="categoryStatus"></app-progress-bars> -->
  </div>